## Описание

График расширенного распределения строится **исключительно для одного вида урона**, поскольку в игре урон принимает только целочисленные значения. Округление урона до целых значений приводит к тому, что при одном и том же разбросе получаются разные графики относительного распределения при разных видах урона.

#### Например, для базового урона в 11 единиц граничные значения
- 11 - 25% = 8.25 => 8 (минимальное значение в игре)
- 11 + 25% = 13.75 => 14 (максимальное значение в игре)

Это значит, что урон может принять любое значение из дискретного ряда `[8, 9, 10, 11, 12, 13, 14]`, или же `[-3, -2, -1, 0, +1, +2, +3]` относительно базового урона. Если выполнить нормализацию значений относительно базового урона, то получим ряд `[-27%, -18%, -9%, 0%, +9%, +18%, +27%]`, в котором всего **4** промежуточных значения `-18%, -9%, +9%, +18%`, а крайние значения `-27%, +27%` выходят за рамки исходного разброса в **25%**. Слияние такого дискретного ряда с графиком, построенным для другого вида урона, например **390**, приведет к возникновению аномальных пиков и провалов, что естественно для дискретных случайных величин, но совершенно не характерно для величин с непрерывным распределением. Поэтому для каждого вида урона строится индивидуальный график распределения вероятностей.

### Граничные значения

График распределения строится из центра, таким образом, чтобы базовый урон располагался строго по центру. По этой причине, на графике возможно только нечетное число значений урона в каждом из его столбиков. Из-за особенностей округления крайних значений иногда наблюдаются некратные интервалы. В таких случаях, крайний левый и крайний правый столбики графика могут содержать разное число значений урона. Если вы хотите оценить минимальный и максимальный урон, то выбирайте шаг графика равный **1**.

#### Например, для базового урона в 390 единиц при 7 значениях на столбик
- 90 - 25% => 293 (минимальное значение в игре)
- 390 + 25% => 488 (максимальное значение в игре)

Следовательно, на графике, слева от базового урона будет **390-293=97** возможных значений, а справа **488-390=98**, в сумме же будет всего **196** значений. Построить симметричный график относительного базового урона в этом случае невозможно, поэтому на графике центральный столбик будет состоять из **7** значений `[387, 388, 389, 390, 391, 392, 393]`, крайний левый столбик из 3 значений `[293, 294, 295]`, а крайний правый из 4 значений `[485, 486, 487, 488]`.

#### Пример для урона в 360 единиц
- 360 - 25% => 270
- 360 + 25% => 450

Диапазон возможных значений урона **[270; 450]** и состоит из **181** значения, **90** из которых находится слева от среднего, а еще **90** справа от него, что позволяет построить зеркально симметричный график с шагом в **1** значение на каждый столбик. При распределении урона по столбикам с шагом в **5** значений, получается **17+1+17=35** центральных столбиков по **5** значений в каждом и два крайних столбика по **3** значения в каждом. В этом случае график сохраняет симметрию относительно центральной оси. При этом следует учитывать, что крайние столбики могут содержать меньше значений, чем остальные.


## Расчёт погрешности
Погрешность графика распределения зависит от:
- базового урона **BASE_DMG** (разная величина ошибки округления)
- количества выстрелов **N** с уроном (влияет на достоверность распределения)
- числа уронов **M** на столбик (меняется форма дискретного графика)

Для определения погрешности искусственно генерируется серия из **X** «экспериментов» распределения при фиксированных значениях указанных выше параметров, и с их помощью определяется возможный диапазон отклонения значений для исходного графика.


### Алгоритм расчета погрешности:
1. Первоначально с помощью стандартного генератора псевдослучайных чисел `math.random()` в `JavaScript` генерируется **N** вещественных значений в диапазоне от **0** до **1**, включительно.
2. Сгенерированный ряд преобразуется в танковое распределение урона подобное Гауссовскому распределению с диапазоном значений от **-1** до **+1**, включительно.
 
С помощью сплайн интерполяции по 100 значений к функции численно обратной функции распределения урона (CDF) для канонического нормального распределения с коэффициентами `a = 0.02399886787, b = -0.006796346129, c = 0.4711312389` в формуле `a*exp(-((x-b)/c)^2)`
 
3. Результирующий ряд умножается на **0.25**, к каждому значению ряда прибавляется **1**, и это все умножается на базовый урон **BASE_DMG**, после чего итоговые значения ряда округляются до ближайших целых чисел.
 
`DMG = round((invCDF(RND) * 0.25 + 1) * BASE_DMG)` - формула для расчета урона
 
4. Значения, полученного ряда, размещаются по столбикам из расчета **M** значений урона на столбик.
5. Алгоритм выше повторяется **X** раз, где **X** - количество «экспериментов», необходимых для расчета погрешности (параметр задается пользователем до начала расчета).
6. По завершении расчетов значения уронов в каждом столбике сортируются по возрастанию, образуя статистические интервалы, которые и определяют возможную погрешность исходного распределения.

### Доверительный интервал

Зная погрешность графика распределения урона, можно построить доверительный интервал с указанием **уровня доверия P**. Интервал отображается на графике в виде двух огибающих линий, обозначающих нижнюю и верхнюю границы доверительного интервала, между которыми находится **P%** «экспериментов» из **X** симуляций.


## Карточки инфографики
### Средний урон
Арифметическое среднее всех уронов в базе данных (сумма делить на количество)

### Медианный урон
Значение урона, разделяющее все значения на две равные части. Если количество значений четное, медиана представляет собой среднее арифметическое двух центральных значений. Это означает, что половина значений урона меньше медианы, а другая половина — больше

### Выстрелов с уроном ниже среднего
Рассчитывается как процент выстрелов с **уроном ниже среднего** по сравнению с выстрелами с **уроном выше среднего**. Выстрелы с базовым уроном не учитываются. В идеальном распределении этот показатель должен составлять **50%**.